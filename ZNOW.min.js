/**
 * ZNOW JavaScript Framework v0.2.0
 * Copyright 2014, Icarus So
 * Licensed under the MIT or GPL Version 2 licenses.
 * Date: Dec 26 2014
 *
 * Copyright (C) 2014 by Icarus So
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

 (function(){if(typeof console==="undefined"||typeof console.warn==="undefined"){console={};console.warn=function(){}}var e=function(){};var t=function(){return e};var n=function(e){return{val:e===undefined?null:e,__read:true}};var r=function(e){return{val:e===undefined?null:e,__const:true}};var i=function(){};var s=function(e){e.__final=true;return e};var o=function(e){e.__virtual=true;return e};var u=function(e){var t="";var n=/^[_|$]*/.exec(e)[0];t="$"+n+"on"+e.charAt(n.length).toUpperCase()+e.substr(n.length+1);return t};var a=function(e,n){var r={};for(var s in e){if(/^static./.test(s))continue;if(!(e[s]instanceof Function))continue;if(/^__/.test(s))continue;if(e[s]==t()){r[s]=t();continue}if(e[s]==i){r[u(s)]=function(e){return function(){var t=arguments;var n=true;this["$$"+e].forEach(function(e){if(!n)return;n=!(e.apply(this,t)===false)});return n}}(s);continue}r[s]=function(t){return function(){return e[t].apply(this,arguments)}}(s);if(e[s].__final)r[s].__final=true}if(!r["init"]&&!r["$init"]&&!r["_init"]){r["init"]=function(){if(n.__baseClass)this.super.apply(this,arguments)}}if(n.__baseClass){var o=n.__baseClass.__methodSet;for(var s in o){if(!(o[s]instanceof Function))continue;if(s[0]=="_")continue;if(r.hasOwnProperty(s)&&o[s].__final){throw new Error("WARN:: final mehtod cannot be overrided "+s)}if(r.hasOwnProperty(s))continue;if(/^[_|$]?init$/.test(s))continue;if(e[s]==t()){r[s]=t();continue}r[s]=function(e){return function(){return o[e].apply(this,arguments)}}(s)}}for(var s in r){r[s]["_"]=n}return r};var f=function(e){var t=function(t){for(var n in e){if(/^static./.test(n))continue;if(e[n]instanceof Function&&e[n]!=i)continue;if(/^__/.test(n))continue;if(e[n].__read){this[n]=e[n].val;this["__read"+n]=true;continue}if(e[n].__const){this[n]=e[n].val;this["__const"+n]=true;continue}if(e[n]==i){this["$$"+n]=[];continue}this[n]=e[n]}if(t){for(var n in t){if(n[0]=="_")continue;if(e[n])continue;Object.defineProperty(this,n,{get:function(e){return function(){return t[e]}}(n),set:function(e){return function(n){if(t["__read"+e]&&e[0]=="$"){console.warn("WARN:: accessing read only attr "+e);return}return t[e]=n}}(n)})}}};return t};var l=function(e,t,n){if(!e)return false;if(e["_"]){var r=e["_"];if(n[0]=="_"){return r==t}do{if(r==t)return e["_"];r=r.__baseClass}while(r);return false}return l(e.caller,t,n)};var c=function(e,n){var r={};var s=[];for(var o in e){if(!/^static./.test(o))continue;var a=o.substr(7);if(e[o].__const){r[a]=e[o].val;r["__const"+a]=true}else if(e[o].__read){r[a]=e[o].val;r["__read"+a]=true}else if(e[o]==i){s.push(a)}else if(e[o]==t()){throw new Error("static method cannot be abstract "+a)}else{r[a]=e[o]}if(r[a]instanceof Function)r[a]["_"]=n}for(var f=0;f<s.length;f++){var a=s[f];r["$$"+a]=[];r[u(a)]=function(e){return function(){var t=arguments;var n=true;this["$$"+e].forEach(function(e){if(!n)return;n=!(e.apply(this,t)===false)});return n}}(a);r[u(a)]["_"]=n}r.on=function(e,t,n){if(this["$$"+e]&&this["$$"+e].indexOf(t)==-1){if(n)this["$$"+e].unshift(t);else this["$$"+e].push(t);return t}return false};r.on["_"]=n;r.off=function(e,t){if(this["$$"+e]&&this["$$"+e].indexOf(t)!=-1){var n=this["$$"+e].indexOf(t);this["$$"+e].splice(n,1);return true}return false};r.off["_"]=n;if(n.__baseClass){var c=n.__baseClass.__staticSet;var h=n.__baseClass;for(var o in c){if(c[o]instanceof Function&&r.hasOwnProperty(o)&&h[o].__final){throw new Error("WARN:: final static method cannot be overrided "+o)}if(r.hasOwnProperty(o))continue;if(c[o]instanceof Function){r[o]=function(e){return function(){return h[e].apply(this,arguments)}}(o);r[o]["_"]=n}else{Object.defineProperty(r,o,{get:function(e){return function(){return h[e]}}(o),set:function(e){return function(t){return h[e]=t}}(o)})}}}for(var o in r){if(r[o]instanceof Function){n[o]=function(e){return function(){if(!/^[_|$]/.test(e)||l(arguments.callee.caller,n,e)){return r[e].apply(this,arguments)}else{console.warn("WARN:: cannnot access static method "+e)}}}(o);if(r[o].__final)n[o].__final=true}else{Object.defineProperty(n,o,{get:function(e){return function(){if(!/^[_|$]/.test(e)||l(arguments.callee.caller,n,e)){return r[e]}else{console.warn("WARN:: cannnot access static attribute "+e)}}}(o),set:function(e){if(r["__const"+e]){return function(){console.warn("WARN:: cannot change const static attribute "+e)}}if(r["__read"+e]){return function(t){var i=l(arguments.callee.caller,n,e);if(!i){console.warn("WARN:: cannot change readonly attribute "+e)}else if(e[0]=="$"&&i!=n){console.warn("WARN:: cannot change readonly attribute "+e)}else{return r[e]=t}}}return function(t){if(!/^[_|$]/.test(e)||l(arguments.callee.caller,n,e)){return r[e]=t}else{console.warn("WARN:: cannnot access static attribute "+e)}}}(o)})}}return r};var h=function(e){var t=[];do{t.push(e);e=e.__baseClass}while(e);return t.reverse()};var p=function(e){var t=[];t[0]=new e[0].__attrTemp;for(var n=1;n<e.length;n++){t[n]=new e[n].__attrTemp(t[n-1])}for(var n=0;n<t.length;n++){var r=t[n];for(var i in r){if(Array.isArray(r[i])){r[i]=r[i].slice()}else if(r[i]instanceof Object){if(Object.keys(r[i]).length==0){r[i]={}}}}}return t};var d=function(e){return e.map(function(e){return e.__methodSet})};var v=function(e,t){var n={};for(var r=e.length-1;r>=0;r--){var i=e[r];var s=t[r];for(var o in i){if(n.hasOwnProperty(o))continue;n[o]=i[o]}for(var o in s){if(n.hasOwnProperty(o))continue;n[o]=s[o]}}return n};var m=function(e,t){if(!e)return-1;if(e["_"]){return t.indexOf(e["_"])}return m(e.caller,t)};var g=function(e,n,r){while(r[e][n]==t()){e++}return e};var y=function(e,t,n){while(n[e][t].__virtual&&e<n.length){e++}return e};var b=function(e,t,n){if(t[0]!="_")return n.length-1;return e};var w=function(e,n,r,i){var s=function(){var e=m(arguments.callee.caller,i);var t=arguments[0];t["_"]=i[e];return t};s.__initialized=false;for(var o in e){if(e[o]instanceof Function){s[o]=function(e){return function(){var t=m(arguments.callee.caller,i);if(t==-1){if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: public accessing private or protected method "+e)}else{var t=n.length-1;return n[t][e].apply(s,arguments)}}else{if(n[t].hasOwnProperty(e)){t=b(t,e,n);return n[t][e].apply(s,arguments)}else{if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: base accessing extended private or protected method "+e)}else{var t=n.length-1;return n[t][e].apply(s,arguments)}}}}}(o)}else{Object.defineProperty(s,o,{get:function(e){return function(){var t=m(arguments.callee.caller,i);if(t==-1){if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: public accessing private or protected method "+e)}else{var t=r.length-1;return r[t][e]}}else{if(r[t].hasOwnProperty(e)){return r[t][e]}else{if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: base accessing extended private or protected attribute "+e)}else{var t=n.length-1;return r[t][e]}}}}}(o),set:function(e){return function(t){var o=m(arguments.callee.caller,i);if(o==-1){if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: public accessing private or protected method "+e)}else{var o=r.length-1;if(r[o]["__read"+e]){console.warn("WARN:: public accessing read only attribute "+e);return}if(s.__initialized&&r[o]["__const"+e]){console.warn("WARN:: cannot change cost attribute "+e);return}return r[o][e]=t}}else{if(s.__initialized&&r[o]["__const"+e]){console.warn("WARN:: cannot change cost attribute "+e);return}if(r[o].hasOwnProperty(e)){return r[o][e]=t}else{if(e[0]=="_"||e[0]=="$"){console.warn("WARN:: base accessing extended private or protected attribute "+e)}else{var o=n.length-1;if(r[o]["__read"+e]){console.warn("WARN:: accessing read only attribute "+e);return}return r[o][e]=t}}}}}(o)})}}var u=function(){var e=m(arguments.callee.caller,i);E(n,e-1,s,arguments)};for(var o in e){if(e[o]instanceof Function){u[o]=function(e){return function(){var r=m(arguments.callee.caller,i);if(n[r].hasOwnProperty(e)){if(n[r-1][e]==t()){r=g(r-1,e,n);return n[r][e].apply(s,arguments)}return n[r-1][e].apply(s,arguments)}else{console.warn("WARN:: super does not have such method "+e)}}}(o)}else{Object.defineProperty(u,o,{get:function(e){return function(){var t=m(arguments.callee.caller,i);if(r[t].hasOwnProperty(e)){return r[t-1][e]}else{console.warn("WARN:: super does not have such attr "+e)}}}(o),set:function(e){return function(t){var n=m(arguments.callee.caller,i);if(r[n].hasOwnProperty(e)){if(r[n-1]["__read"+e]){console.warn("WARN:: accessing read only attribute "+e);return}if(s.__initialized&&r[n]["__const"+e]){console.warn("WARN:: cannot change cost attribute "+e);return}return r[n-1][e]=t}else{console.warn("WARN:: super does not have such attr "+e)}}}(o)})}}Object.defineProperty(s,"super",{get:function(){var e=m(arguments.callee.caller,i);if(e==-1){console.warn("WARN:: public access super")}else if(e==0){console.warn("WARN:: no super for this class")}else{return u}}});s.on=function(e,t,n){if(this["$$"+e]&&this["$$"+e].indexOf(t)==-1){if(n)this["$$"+e].unshift(t);else this["$$"+e].push(t);return t}return false};s.on["_"]=i[0];s.off=function(e,t){if(this["$$"+e]&&this["$$"+e].indexOf(t)!=-1){var n=this["$$"+e].indexOf(t);this["$$"+e].splice(n,1);return true}return false};s.off["_"]=i[0];s.class=i[i.length-1];s.instanceOf=function(e){return i.indexOf(e)!=-1};return s};var E=function(e,t,n,r){if(e[t].hasOwnProperty("init")){e[t].init.apply(n,r)}else if(e[t].hasOwnProperty("$init")){e[t].$init.apply(n,r)}else if(e[t].hasOwnProperty("_init")){e[t]._init.apply(n,r)}n.__initialized=true};var S=function(e,n){for(var r in e){if(e[r]==t()){throw new Error("WARN:: some methods have not been implemented "+r)}}for(var r in n){if(!e[r])throw new Error("some methods have not been implemented "+r)}};var x=function(e,t){var n={};for(var r=0;r<e.length;r++){var i=e[r];for(var s in i){n[s]=true}}for(var s in t){if(!n[s])throw new Error("some methods have not been implemented "+s)}};var T=function(e){if(!(e instanceof Array))e=[e];var t={};for(var n=0;n<e.length;n++){var r=e[n];for(var i in r){t[i]=r[i]}}return t};var N=function(e){var t={};for(var n in e){t[n]=e[n]}return t};var C=function(e){var t=function(){if(!(this instanceof t)){var e=arguments[0];if(e instanceof Function){e["_"]=t;return e}throw new Error("Class must be initialized with new operator")}var i=p(n);var s=v(r,i);S(s,t.__intf);var o=w(s,r,i,n);E(r,r.length-1,o,arguments);return o};if(e.__baseClass)t.__baseClass=e.__baseClass;t.__methodSet=a(e,t);t.__attrTemp=f(e);t.__module=e;t.__staticSet=c(e,t);t.__intf=e.__intf;var n=h(t);var r=d(n);x(r,t.__intf);return t};C.extends=function(e){var t=function(t){var n=N(t);n.__baseClass=e;return C(n)};t.implements=function(t){return function(n){var r=N(n);r.__baseClass=e;r.__intf=T(t);return C(r)}};return t};C.implements=function(e){var t=T(e);return function(e){e.__intf=t;return C(e)}};C.pretends=function(e){var t=function(t){var n=N(e.__module);for(var r in t){n[r]=t[r]}return C(n)};t.implements=function(t){return function(n){var r=N(e.__module);for(var i in n){r[i]=n[i]}r.__intf=T(t);return C(r)}};return t};var k=function(e){var n={};for(var r in e){if(r[0]=="_")throw new Error("Interface cannot delare private methods; invalid method "+r);if(e[r]!=t()&&e[r]!=i)throw new Error("Interface methods must be abstract; invalidmethod "+r);n[r]=t()}return n};k.extends=function(e){if(!(e instanceof Array))e=[e];return function(t){e.push(t);var n={};for(var r=0;r<e.length;r++){var i=e[r];for(var s in i){n[s]=i[s]}}return k(n)}};var L;if(typeof window!=="undefined"){L=window}else if(typeof GLOBAL!=="undefined"){L=GLOBAL}L.ABSTRACT=t;L.READ=n;L.CONST=r;L.EVENT=i;L.FINAL=s;L.Class=C;L.Interface=k})()